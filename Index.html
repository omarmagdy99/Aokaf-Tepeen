<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Ø®Ø·Ø¨Ø§Ø¡ Ø§Ù„ØªØ¨ÙŠÙ† - Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</title>
    <style>
        /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f6f9;
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        
        .container {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            margin: 10px auto;
        }
        
        h1 {
            color: #1e3c5c;
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.8em;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }
        
        input[type="text"] {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border 0.3s;
            -webkit-appearance: none;
        }
        
        input[type="text"]:focus {
            border-color: #3498db;
            outline: none;
        }
        
        button {
            background-color: #1e3c5c;
            color: white;
            padding: 16px 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            width: 100%;
            transition: background-color 0.3s;
            margin-bottom: 20px;
            -webkit-tap-highlight-color: transparent;
        }
        
        button:hover {
            background-color: #143244;
        }
        
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        #results {
            margin-top: 20px;
            border-top: 2px solid #eee;
            padding-top: 20px;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .preacher-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-top: 15px;
        }
        
        /* Ø­Ø§ÙˆÙŠØ© Ø²Ø± Ø§Ù„Ù†Ø³Ø® */
        .copy-button-container {
            background: linear-gradient(135deg, #1e3c5c 0%, #2c5282 100%);
            padding: 15px 20px 5px 20px;
            display: flex;
            justify-content: flex-end;
        }
        
        /* Ø²Ø± Ø§Ù„Ù†Ø³Ø® */
        .copy-button {
            background-color: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 40px;
            padding: 10px 20px;
            font-size: 15px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
            border: none;
            width: fit-content;
            font-weight: 500;
            -webkit-tap-highlight-color: transparent;
        }
        
        .copy-button:hover {
            background-color: rgba(255,255,255,0.3);
        }
        
        .copy-button:active {
            transform: scale(0.95);
        }
        
        .copy-button.copied {
            background-color: #27ae60;
        }
        
        /* Ø±Ø£Ø³ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© - Ø§Ø³Ù… Ø§Ù„Ø®Ø·ÙŠØ¨ */
        .preacher-header {
            background: linear-gradient(135deg, #1e3c5c 0%, #2c5282 100%);
            color: white;
            padding: 0px 20px 20px 20px;
        }
        
        .preacher-name {
            font-size: 1.6em;
            font-weight: bold;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
            word-break: break-word;
            line-height: 1.4;
        }
        
        .preacher-name-icon {
            font-size: 1.4em;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ ØªØ­Ø°ÙŠØ± Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ */
        .error-alert {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-right: 6px solid #dc2626;
            padding: 15px;
            margin: 15px 15px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(220, 38, 38, 0.1);
        }
        
        .error-alert-title {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #991b1b;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 12px;
        }
        
        .error-alert-title span {
            font-size: 1.4em;
        }
        
        .error-item {
            background-color: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 10px;
            border-right: 4px solid #dc2626;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 8px;
            color: #7f1d1d;
            font-size: 0.95em;
        }
        
        .error-item:last-child {
            margin-bottom: 0;
        }
        
        .error-icon {
            font-size: 1.2em;
        }
        
        .error-mosque {
            font-weight: bold;
            color: #991b1b;
        }
        
        .error-order {
            background-color: #fee2e2;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            color: #991b1b;
        }
        
        /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© - Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø®Ø·Ø¨ */
        .sermons-table {
            padding: 15px;
            background-color: #f8fafc;
        }
        
        .sermon-row {
            display: flex;
            flex-direction: column;
            padding: 15px;
            margin-bottom: 10px;
            background-color: white;
            border-radius: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s;
            border-right: 4px solid transparent;
        }
        
        .sermon-row.present {
            border-right-color: #27ae60;
        }
        
        .sermon-row.rest {
            border-right-color: #e67e22;
            background-color: #fffaf0;
        }
        
        .sermon-order {
            font-weight: 600;
            color: #4a5568;
            font-size: 1em;
            margin-bottom: 8px;
        }
        
        .sermon-content {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .sermon-icon {
            font-size: 1.2em;
        }
        
        .sermon-mosque {
            font-size: 1.1em;
            color: #2c3e50;
            font-weight: 500;
            word-break: break-word;
            flex: 1;
        }
        
        .rest-badge {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            padding: 8px 18px;
            border-radius: 40px;
            font-size: 0.95em;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 2px 5px rgba(251, 191, 36, 0.2);
            width: 100%;
        }
        
        .rest-badge span {
            font-size: 1.2em;
        }
        
        /* Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹ */
        .quick-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 0 15px 15px 15px;
            padding: 15px;
            background-color: #e8f4f8;
            border-radius: 14px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #1e3c5c;
            font-size: 0.95em;
            background: rgba(255,255,255,0.5);
            padding: 8px 15px;
            border-radius: 30px;
        }
        
        .stat-icon {
            font-size: 1.2em;
        }
        
        .stat-value {
            font-weight: bold;
            margin-left: 4px;
        }
        
        .footer-quote {
            margin: 0 15px 15px 15px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            text-align: center;
            color: #6c757d;
            font-style: italic;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        .no-results, .error-message {
            text-align: center;
            padding: 30px 20px;
            background-color: #f9f9f9;
            border-radius: 16px;
            margin: 20px 0;
        }
        
        .no-results {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .error-message {
            color: #c0392b;
            background-color: #f2dede;
            border: 1px solid #e74c3c;
        }
        
        .loading {
            text-align: center;
            color: #3498db;
            font-weight: bold;
            margin: 20px 0;
            padding: 20px;
            font-size: 1.2em;
        }
        
        .footer-note {
            margin-top: 20px;
            font-size: 0.85em;
            color: #7f8c8d;
            text-align: center;
            padding: 0 10px;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.5em;
                margin-bottom: 20px;
            }
            
            .preacher-name {
                font-size: 1.4em;
            }
            
            .copy-button {
                padding: 8px 16px;
                font-size: 14px;
            }
            
            .sermon-order {
                font-size: 0.95em;
            }
            
            .sermon-mosque {
                font-size: 1em;
            }
            
            .rest-badge {
                font-size: 0.9em;
                padding: 6px 14px;
            }
            
            .stat-item {
                font-size: 0.9em;
                padding: 6px 12px;
            }
            
            .error-item {
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Ø®Ø·Ø¨Ø§Ø¡ Ø§Ù„ØªØ¨ÙŠÙ†</h1>

        <label for="nationalId">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</label>
        <input type="text" id="nationalId" placeholder="Ù…Ø«Ø§Ù„: 12345678901234" inputmode="numeric" maxlength="14">
        <button id="searchBtn">Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø®Ø·Ø¨</button>

        <div id="results"></div>
        <div class="footer-note">
            * Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets
        </div>
    </div>

    <script>
        // âœ… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Øµ Ø¨Ù€ Google Apps Script
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxM-Ev7G4baHGJ8mIDLCaNoi_g7K2fAUk2uJSJz7ZReB93YARS9sRvan3rZaFRBBUcrkA/exec';
        
        const nationalIdInput = document.getElementById('nationalId');
        const searchBtn = document.getElementById('searchBtn');
        const resultsDiv = document.getElementById('results');

        // Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¥Ø³ØªØ±Ø§Ø­Ø©
        const restMessages = [
            "ğŸŒ¿ Ø¥Ø¬Ø§Ø²Ø©",
            "ğŸŒ¸ Ø§Ø³ØªØ±Ø§Ø­Ø©",
            "âœ¨ Ø¥Ø¬Ø§Ø²Ø©",
            "ğŸ•Šï¸ Ø±Ø§Ø­Ø©",
            "ğŸƒ Ø¥Ø¬Ø§Ø²Ø©",
            "ğŸŒŸ Ù…ØªÙØ±Øº"
        ];

        // // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©
        // function showCopyAlert(success) {
        //     if (success) {
        //         alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
        //     } else {
        //         alert('âŒ ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰');
        //     }
        // }

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© ÙˆØ§Ù„Ù…Ø¤ÙƒØ¯Ø©
        function copyToClipboard(text, button) {
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù†Øµ
            if (!text) {
                alert('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Øµ Ù„Ù„Ù†Ø³Ø®');
                return;
            }
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù†Ø³Ø®
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    // Ù†Ø¬Ø§Ø­
                    button.textContent = 'âœ“ ØªÙ…!';
                    button.classList.add('copied');
                    showCopyAlert(true);
                    
                    setTimeout(() => {
                        button.textContent = 'ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø¬Ø¯ÙˆÙ„';
                        button.classList.remove('copied');
                    }, 2000);
                }).catch(err => {
                    console.error('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®:', err);
                    showCopyAlert(false);
                });
            } else {
                // Ù„Ùˆ Ø§Ù„Ù…ØªØµÙØ­ Ù‚Ø¯ÙŠÙ…
                alert('âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø®Ø§ØµÙŠØ© Ø§Ù„Ù†Ø³Ø®');
            }
        }

        // ØªØ­Ø¶ÙŠØ± Ù†Øµ Ø§Ù„Ù†Ø³Ø®
        function createCopyContent(preacherName, sermonsList, errors) {
            let content = `ğŸ™ï¸ Ø§Ù„Ø´ÙŠØ® ${preacherName}\n`;
            content += `ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø®Ø·Ø¨:\n`;
            content += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
            
            sermonsList.forEach((sermon) => {
                const orderText = getSermonOrderText(sermon.order);
                if (sermon.hasPreacher) {
                    content += `Ø§Ù„Ø®Ø·Ø¨Ø© ${orderText}: ${sermon.mosque}\n`;
                } else {
                    const restMessage = getRandomRestMessage();
                    content += `Ø§Ù„Ø®Ø·Ø¨Ø© ${orderText}: ${restMessage}\n`;
                }
            });
            
            if (errors.length > 0) {
                content += `\nâš ï¸ ØªÙ†Ø¨ÙŠÙ‡: ÙŠÙˆØ¬Ø¯ Ø®Ø·Ø£!\n`;
                errors.forEach(error => {
                    content += `- Ù…ÙƒØ±Ø± ÙÙŠ Ø§Ù„Ø®Ø·Ø¨Ø© ${getSermonOrderText(error.order)}: ${error.mosques.join(' Ùˆ ')}\n`;
                });
            }
            
            content += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
            content += `ğŸ“… ${new Date().toLocaleDateString('ar-EG')}\n`;
            content += `ğŸ”— Ù†Ø¸Ø§Ù… Ø®Ø·Ø¨Ø§Ø¡ Ø§Ù„ØªØ¨ÙŠÙ†`;
            
            return content;
        }

        async function fetchAllData() {
            try {
                const response = await fetch(APPS_SCRIPT_URL);
                if (!response.ok) throw new Error('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„');
                const data = await response.json();
                if (data.error) throw new Error(data.error);
                return data;
            } catch (error) {
                console.error('Ø®Ø·Ø£:', error);
                throw error;
            }
        }

        function getRandomRestMessage() {
            return restMessages[Math.floor(Math.random() * restMessages.length)];
        }

        function getSermonOrderText(order) {
            const orders = ['Ø§Ù„Ø£ÙˆÙ„Ù‰', 'Ø§Ù„Ø«Ø§Ù†ÙŠØ©', 'Ø§Ù„Ø«Ø§Ù„Ø«Ø©', 'Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©'];
            return orders[order - 1] || order;
        }

        // ÙƒØ´Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        function detectErrors(sermonsByMosque, preacherName) {
            const errors = [];
            for (let order = 1; order <= 4; order++) {
                const mosquesWithPreacher = [];
                sermonsByMosque.forEach(mosque => {
                    const sermon = mosque.sermons.find(s => s.order === order);
                    if (sermon && sermon.preacher === preacherName) {
                        mosquesWithPreacher.push(mosque.name);
                    }
                });
                if (mosquesWithPreacher.length > 1) {
                    errors.push({ order, mosques: mosquesWithPreacher });
                }
            }
            return errors;
        }

        async function performSearch() {
            const nationalId = nationalIdInput.value.trim();
            
            if (!nationalId) {
                resultsDiv.innerHTML = '<div class="error-message">âŒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ</div>';
                return;
            }

            searchBtn.disabled = true;
            searchBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...';
            resultsDiv.innerHTML = '<div class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';

            try {
                const allData = await fetchAllData();
                const preachersData = allData.preachers;
                const sermonsData = allData.sermons;

                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø®Ø·ÙŠØ¨
                let preacherName = null;
                if (preachersData && preachersData.length > 0) {
                    const startRow = (preachersData[0]?.[0] === 'Ø§Ù„Ø§Ø³Ù…') ? 1 : 0;
                    for (let i = startRow; i < preachersData.length; i++) {
                        const row = preachersData[i];
                        if (row?.length >= 2 && row[1]?.toString().trim() === nationalId) {
                            preacherName = row[0]?.toString().trim() || null;
                            break;
                        }
                    }
                }

                if (!preacherName) {
                    resultsDiv.innerHTML = '<div class="no-results">ğŸ˜• Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø®Ø·ÙŠØ¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…</div>';
                    searchBtn.disabled = false;
                    searchBtn.textContent = 'Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø®Ø·Ø¨';
                    return;
                }

                // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§Ø¬Ø¯
                const sermonsByMosque = [];
                
                if (sermonsData && sermonsData.length > 0) {
                    const startRow = (sermonsData[0]?.[0] === 'Ø§Ù„Ù…Ø³Ø¬Ø¯') ? 1 : 0;
                    
                    for (let i = startRow; i < sermonsData.length; i++) {
                        const row = sermonsData[i];
                        if (!row || row.length < 6) continue;

                        let mosqueName = row[0]?.toString().trim() || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                        const area = row[1]?.toString().trim() || '';
                        
                        // ØªÙ†Ø¸ÙŠÙ Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¬Ø¯
                        if (mosqueName.includes(' - ') && preacherName) {
                            const parts = mosqueName.split(' - ');
                            if (parts[0].includes(preacherName) || parts[0].includes('Ø§Ù„Ø´ÙŠØ®') || parts[0].includes('Ø¯/')) {
                                mosqueName = parts.slice(1).join(' - ');
                            }
                        }
                        
                        const mosqueDisplay = area ? `${mosqueName} - ${area}` : mosqueName;
                        
                        const sermons = [2,3,4,5].map((col, idx) => ({
                            order: idx + 1,
                            preacher: row[col]?.toString().trim() || ''
                        }));
                        
                        sermonsByMosque.push({
                            name: mosqueDisplay,
                            sermons: sermons
                        });
                    }
                }

                // ÙƒØ´Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
                const errors = detectErrors(sermonsByMosque, preacherName);

                // ØªØ¬Ù…ÙŠØ¹ Ø®Ø·Ø¨ Ø§Ù„Ø®Ø·ÙŠØ¨
                const allSermons = [];
                sermonsByMosque.forEach(mosque => {
                    mosque.sermons.forEach(sermon => {
                        if (sermon.preacher === preacherName) {
                            allSermons.push({
                                order: sermon.order,
                                mosque: mosque.name,
                                hasPreacher: true
                            });
                        }
                    });
                });

                // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø®Ø·Ø¨
                const orderedSermons = [];
                for (let order = 1; order <= 4; order++) {
                    const sermonsInOrder = allSermons.filter(s => s.order === order);
                    if (sermonsInOrder.length > 0) {
                        sermonsInOrder.forEach(s => orderedSermons.push(s));
                    } else {
                        orderedSermons.push({
                            order: order,
                            mosque: null,
                            hasPreacher: false
                        });
                    }
                }

                displayResults(preacherName, orderedSermons, errors);

            } catch (error) {
                resultsDiv.innerHTML = `<div class="error-message">âŒ Ø®Ø·Ø£: ${error.message}</div>`;
            } finally {
                searchBtn.disabled = false;
                searchBtn.textContent = 'Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø®Ø·Ø¨';
            }
        }

        function displayResults(preacherName, sermonsList, errors) {
            const totalSermons = sermonsList.filter(s => s.hasPreacher).length;
            const totalRest = sermonsList.filter(s => !s.hasPreacher).length;
            const hasErrors = errors.length > 0;

            let resultsHTML = `
                <div class="preacher-card">
                    <div class="copy-button-container">
                        <button class="copy-button" id="mainCopyButton">
                            <span>ğŸ“‹</span> Ù†Ø³Ø® Ø§Ù„Ø¬Ø¯ÙˆÙ„
                        </button>
                    </div>
                    
                    <div class="preacher-header">
                        <div class="preacher-name">
                            <span class="preacher-name-icon">ğŸ™ï¸</span>
                            ${preacherName}
                        </div>
                    </div>
            `;

            if (hasErrors) {
                resultsHTML += `
                    <div class="error-alert">
                        <div class="error-alert-title">
                            <span>âš ï¸</span> Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </div>
                `;
                
                errors.forEach(error => {
                    resultsHTML += `
                        <div class="error-item">
                            <span class="error-icon">ğŸ”´</span>
                            <span>Ù…ÙƒØ±Ø± ÙÙŠ <strong>Ø§Ù„Ø®Ø·Ø¨Ø© ${getSermonOrderText(error.order)}</strong>:</span>
                            <span class="error-mosque">${error.mosques.join(' Ùˆ ')}</span>
                        </div>
                    `;
                });
                resultsHTML += `</div>`;
            }

            resultsHTML += `<div class="sermons-table">`;

            sermonsList.forEach((sermon) => {
                const orderText = getSermonOrderText(sermon.order);
                
                if (sermon.hasPreacher) {
                    resultsHTML += `
                        <div class="sermon-row present">
                            <div class="sermon-order">Ø§Ù„Ø®Ø·Ø¨Ø© ${orderText}</div>
                            <div class="sermon-content">
                                <span class="sermon-icon">ğŸ“Œ</span>
                                <span class="sermon-mosque">${sermon.mosque}</span>
                            </div>
                        </div>
                    `;
                } else {
                    const restMessage = getRandomRestMessage();
                    resultsHTML += `
                        <div class="sermon-row rest">
                            <div class="sermon-order">Ø§Ù„Ø®Ø·Ø¨Ø© ${orderText}</div>
                            <div class="sermon-content">
                                <div class="rest-badge">
                                    <span>ğŸŒ¿</span> ${restMessage}
                                </div>
                            </div>
                        </div>
                    `;
                }
            });

            resultsHTML += `</div>`;

            resultsHTML += `
                <div class="quick-stats">
                    <div class="stat-item">
                        <span class="stat-icon">ğŸ“Š</span>
                        <span><span class="stat-value">${totalSermons}</span> Ø®Ø·Ø¨</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">ğŸŒ¿</span>
                        <span><span class="stat-value">${totalRest}</span> Ø¥Ø¬Ø§Ø²Ø§Øª</span>
                    </div>
                    ${hasErrors ? `
                    <div class="stat-item" style="color:#dc2626">
                        <span class="stat-icon">âš ï¸</span>
                        <span><span class="stat-value">${errors.length}</span> Ø£Ø®Ø·Ø§Ø¡</span>
                    </div>
                    ` : ''}
                </div>
                <div class="footer-quote">
                    "ÙˆÙØ±ÙØ¨ÙÙ‘ÙƒÙ ÙŠÙØ®Ù’Ù„ÙÙ‚Ù Ù…ÙØ§ ÙŠÙØ´ÙØ§Ø¡Ù ÙˆÙÙŠÙØ®Ù’ØªÙØ§Ø±Ù" ğŸŒ™
                </div>
            </div>`;

            resultsDiv.innerHTML = resultsHTML;

            // âœ… Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ù†Ø³Ø® Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            const copyBtn = document.getElementById('mainCopyButton');
            if (copyBtn) {
                copyBtn.onclick = function() {
                    const content = createCopyContent(preacherName, sermonsList, errors);
                    copyToClipboard(content, this);
                };
            }
        }

        // Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø¨Ø­Ø«
        searchBtn.addEventListener('click', performSearch);
        
        // Ø±Ø¨Ø· Ø²Ø± Enter
        nationalIdInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') performSearch();
        });
    </script>
</body>
</html>